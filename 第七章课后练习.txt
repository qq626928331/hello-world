-- 第七章 练习1 1题
SELECT SUM(SAL),AVG(sal)
FROM emp
WHERE DEPTNO=20

-- 第七章 练习1 2题
SELECT COUNT(EMPNO),SUM(SAL),MIN(SAL)
FROM EMP E,dept D
WHERE E.DEPTNO=D.DEPTNO AND LOC='CHICAGO'

-- 第七章 练习1 3题
SELECT COUNT(DISTINCT JOB)
FROM emp


-- 第七章 练习2 1题
SELECT D.DEPTNO,D.DNAME,COUNT(EMPNO),MAX(SAL),MIN(SAL),SUM(SAL),AVG(SAL)
FROM emp E,dept D
WHERE E.DEPTNO=D.DEPTNO
GROUP BY E.DEPTNO

-- 第七章 练习2 2题
SELECT D.DEPTNO,D.DNAME,E.JOB,COUNT(EMPNO),MAX(SAL),MIN(SAL),SUM(SAL),AVG(SAL)
FROM emp E,dept D
WHERE E.DEPTNO=D.DEPTNO
GROUP BY E.DEPTNO,E.JOB

-- 第七章 练习2 3题
SELECT COUNT(E.EMPNO),E.MGR,M.ENAME
FROM emp E
LEFT JOIN emp M ON (E.MGR=M.EMPNO)
GROUP BY E.MGR/*问题上涉及到每个概念的需要分组*/


-- 第七章 练习3 1题
SELECT E.DEPTNO,DNAME,COUNT(EMPNO)
FROM emp E,dept D
WHERE E.DEPTNO=D.DEPTNO
GROUP BY D.DEPTNO
HAVING COUNT(EMPNO)>2

-- 第七章 练习3 2题
SELECT E.DEPTNO,D.DNAME,COUNT(EMPNO),AVG(SAL)
FROM emp E,dept D
WHERE E.DEPTNO=D.DEPTNO
GROUP BY E.DEPTNO
HAVING COUNT(EMPNO)>2 AND AVG(SAL)>2000
ORDER BY COUNT(EMPNO)


-- 第七章 练习4 1题
SELECT ENAME,HIREDATE
FROM emp
HAVING MIN(HIREDATE)

-- 第七章 练习4 2题
SELECT ENAME,SAL,DNAME
FROM emp E,dept D
WHERE E.DEPTNO=D.DEPTNO AND LOC='CHICAGO'
HAVING SAL>(SELECT SAL FROM emp WHERE ENAME='SMITH')

-- 第七章 练习4 3题
SELECT ENAME,HIREDATE
FROM emp
WHERE HIREDATE<(SELECT MIN(HIREDATE) FROM EMP WHERE DEPTNO=10 )

-- 第七章 练习4 4题
SELECT D.DEPTNO,D.DNAME,COUNT(EMPNO)
FROM emp E,dept D
WHERE D.DEPTNO=E.DEPTNO
GROUP BY E.DEPTNO
HAVING COUNT(EMPNO)>
	(	SELECT COUNT(EMPNO)/COUNT(DISTINCT DEPTNO) 
		FROM EMP
	)


-- 第七章 练习5 1题
SELECT ENAME,HIREDATE
FROM emp
WHERE HIREDATE < ANY (SELECT HIREDATE FROM emp WHERE DEPTNO=10)
AND DEPTNO NOT IN (10)

-- 第七章 练习5 2题
SELECT ENAME,HIREDATE
FROM emp
WHERE HIREDATE < ALL (SELECT HIREDATE FROM emp WHERE DEPTNO=10)
AND DEPTNO NOT IN (10)

-- 第七章 练习5 3题
SELECT ENAME,JOB
FROM emp
WHERE JOB = ANY(SELECT JOB FROM emp WHERE DEPTNO=10)
AND DEPTNO NOT IN (10)


-- 第七章 课后作业 1题
SELECT DNAME,AVG(SAL)
FROM emp,dept
WHERE emp.DEPTNO=dept.DEPTNO
GROUP BY emp.DEPTNO
HAVING AVG(SAL)>2500

-- 第七章 课后作业 2题
SELECT JOB,ROUND(AVG(SAL))
FROM emp
WHERE JOB NOT LIKE 'SA%' 
GROUP BY JOB
HAVING AVG(SAL)>2500

-- 第七章 课后作业 3题
SELECT DNAME,ROUND(MIN(SAL)),ROUND(MAX(SAL))
FROM emp,dept
WHERE emp.DEPTNO=dept.DEPTNO
GROUP BY emp.DEPTNO
HAVING COUNT(EMPNO)>2

-- 第七章 课后作业 4题
SELECT job,SUM(SAL)
FROM emp
WHERE JOB <> 'SALESMAN'
GROUP BY JOB
HAVING SUM(SAL)>=2500

-- 第七章 课后作业 5题
SELECT M.EMPNO,M.ENAME,MIN(E.SAL)
FROM emp E
LEFT JOIN emp M ON (E.MGR=M.EMPNO )
GROUP BY E.MGR
HAVING MIN(E.SAL)>=3000
ORDER BY MIN(E.SAL)

-- 第七章 课后作业 6题
SELECT EMPNO,ENAME,SAL
FROM emp
WHERE SAL>(SELECT SAL FROM emp WHERE EMPNO=7782)
AND JOB=(SELECT JOB FROM emp WHERE EMPNO=7369)

-- 第七章 课后作业 7题
SELECT ENAME,MAX(SAL)
FROM emp

-- 第七章 课后作业 8题
SELECT D.DEPTNO,DNAME,MIN(SAL)
FROM emp E,dept D
WHERE E.DEPTNO=D.DEPTNO
GROUP BY D.DEPTNO
HAVING MIN(SAL)>(SELECT MIN(SAL) FROM emp WHERE DEPTNO=10)

-- 第七章 课后作业 9题
SELECT DEPTNO,ENAME,MIN(sal)
FROM emp
GROUP BY DEPTNO

-- 第七章 课后作业 10题
SELECT E.ENAME,E.sal
FROM emp E,emp M
WHERE E.MGR=M.EMPNO 
AND M.ENAME='KING'

-- 第七章 课后作业 11题
SELECT ENAME,SAL,HIREDATE
FROM emp
WHERE HIREDATE>(SELECT HIREDATE FROM emp WHERE ENAME='SMITH')

-- 第七章 课后作业 12题
SELECT ENAME
FROM emp 
WHERE DEPTNO=(SELECT DEPTNO FROM dept WHERE LOC='NEW YORK' )

-- 第七章 课后作业 13题
SELECT ENAME,HIREDATE
FROM emp E,dept D
WHERE E.DEPTNO=D.DEPTNO
AND LOC=(SELECT LOC FROM emp,dept WHERE EMP.DEPTNO=dept.DEPTNO AND ENAME='SMITH')

-- 第七章 课后作业 14题
SELECT EMPNO,ENAME
FROM emp 
WHERE SAL>ALL (SELECT AVG(SAL) FROM emp )

-- 第七章 课后作业 15题
SELECT DNAME,COUNT(EMPNO)
FROM EMP E,dept D
WHERE E.DEPTNO=D.DEPTNO
GROUP BY D.DEPTNO

-- 第七章 课后作业 16题
SELECT ENAME,MAX(SAL)
FROM EMP E,dept D
WHERE E.DEPTNO=D.DEPTNO
GROUP BY D.DEPTNO

-- 第七章 课后作业 17题
SELECT ENAME,sal
FROM emp
WHERE DEPTNO=(SELECT DEPTNO FROM emp WHERE EMPNO=7369)

-- 第七章 课后作业 18题
SELECT ENAME
FROM emp
WHERE ENAME LIKE '%W%'
